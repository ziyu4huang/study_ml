# Reference: install tensorflow 2.7 macos
# https://betterdatascience.com/install-tensorflow-2-7-on-macbook-pro-m1-pro/
#

# STEP_#1 homebrew
#> /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# STEP_#2 xcode
#> xcode-select --install

# STEP_#3 instal conda M1(ARM) 
# https://docs.ray.io/en/latest/ray-overview/installation.html#m1-mac-apple-silicon-support
# wget https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-MacOSX-arm64.sh
# bash Miniforge3-MacOSX-arm64.sh
# rm https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-MacOSX-arm64.sh # Cleanup.

# STEP_#4 CREATE conda enviroment, INSTALL tensorflow from Apple Channel 
#1> conda create --name ray python=3.9; conda activate ray
#2> conda install -c apple tensorflow-deps -y
#3> conda install -c conda-forge jupyterlab

#img ![tf macos](https://betterdatascience.com/content/images/size/w1000/2021/12/6-min.png)

# <SKIP HERE> pip install tensorflow-macos (compbine to pip-compile)
# <SKIP HERE> pip install tensorflow-metal (compbine to pip-compile)


# STEP_#6 generate via pip-compile
# Install Ray as you normally would. using requirement.txt 
# ==== compile.sh ================
# pip-compile \
#     --allow-unsafe \
#     --generate-hashes \
#     requirements.in \
#     --output-file=requirements.txt
# 
# 
# ===== requirements.in =======
setuptools
tensorflow-macos
tensorflow-metal
tensorboard
ray[default,data,rllib,tune,serve]
pyarrow
dask
ipython

jupyter
notebook
jupyterlab

ipywidgets         
jupyter_console    
jupyterlab_widgets 
prompt_toolkit     
widgetsnbextension 
# END == requirements.in =======

# STEP #7 install requirements.txt generate from last step
#> pip-sync requirements.txt

# STEP #8 step special for grpcio hack
#> pip uninstall grpcio; conda install grpcio  --force-reinstall

